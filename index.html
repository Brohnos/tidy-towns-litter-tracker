<!DOCTYPE html>
<html>
<head>
    <title>Tidy Towns Trash Tracker</title>

<style>
    #map {
        height: 100vh; /* This makes the map take up the full height of the page */
        width: 100%; /* This makes the map take up the full width of the page */
    }
</style>

</head>
<body>
    
    <div id="sign-up">
    <h2>Sign Up</h2>
    <input id="email" type="email" placeholder="Email">
    <input id="password" type="password" placeholder="Password">
    <button id="sign-up-btn">Sign Up</button>
    <p id="sign-up-message" style="display: none;"></p>
</div>
    
    <div id="map"></div>
    
        <!-- A form for users to log in -->
    <form id="login-form">
        <input type="email" id="email-field" placeholder="Email">
        <input type="password" id="password-field" placeholder="Password">
        <button type="submit">Log in</button>
    </form>

    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>

    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-auth.js"></script>

    <script>
const firebaseConfig = {
  apiKey: "AIzaSyDcfiNc46fa84JCUigitTvwvlUF_XNIGKs",
  authDomain: "tidy-towns-litter-tracker.firebaseapp.com",
  databaseURL: "https://tidy-towns-litter-tracker-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "tidy-towns-litter-tracker",
  storageBucket: "tidy-towns-litter-tracker.appspot.com",
  messagingSenderId: "532639980959",
  appId: "1:532639980959:web:a62234e579947ce5a831aa",
  measurementId: "G-SZZW59VS4Q"
};

  // Initialize Firebase
firebase.initializeApp(firebaseConfig);

// Get a reference to the Firestore database
let db = firebase.firestore();
        
document.getElementById('sign-up-btn').addEventListener('click', () => {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;

    firebase.auth().createUserWithEmailAndPassword(email, password)
    .then((userCredential) => {
        var user = userCredential.user;
        // Display a success message
        document.getElementById('sign-up-message').textContent = 'Signed up successfully. Check your email for a verification link.';
        document.getElementById('sign-up-message').style.display = 'block';
        // Send an email verification link
        user.sendEmailVerification();
    })
    .catch((error) => {
        var errorCode = error.code;
        var errorMessage = error.message;
        // Handle errors here.
    });
});

// Get a reference to the login form and the input fields.
let loginForm = document.getElementById('login-form');
let emailField = document.getElementById('email-field');
let passwordField = document.getElementById('password-field');
let signUpSection = document.getElementById('sign-up');

// When the form is submitted, attempt to log in.
loginForm.addEventListener('submit', function(event) {
    event.preventDefault(); // Prevent the form from being submitted the normal way.

    let email = emailField.value;
    let password = passwordField.value;

    firebase.auth().signInWithEmailAndPassword(email, password)
    .then((userCredential) => {
        // Signed in 
        let user = userCredential.user;
        // user is now signed in, you can use the user object for its information.
        // Show an alert to the user
        alert("You are now logged in");

        // Hide the login and sign up forms
        loginForm.style.display = 'none';
        signUpSection.style.display = 'none';
    })
    .catch((error) => {
        let errorCode = error.code;
        let errorMessage = error.message;
        // Show the error to your user.
    });
});

// Create a new map
function initMap() {
    var map = new google.maps.Map(document.getElementById('map'), {
        center: {lat: 52.260465, lng: -7.010256}, // Coordinates for Faithlegg
        zoom: 14,
        mapTypeId: 'satellite' // Set the map type to satellite
    });

    let markersMapping = {};

  db.collection("markers").onSnapshot((querySnapshot) => {
    querySnapshot.docChanges().forEach((change) => {
        let data = change.doc.data();
        let docId = change.doc.id;

        if (change.type === "added" || change.type === "modified") {
            let marker = markersMapping[docId] || createMarker(data.lat, data.lng, docId, map, db);
            markersMapping[docId] = marker;
            
            let infoWindow = marker.infoWindow;
            infoWindow.setContent("<p>Leave comment</p><textarea id='input-comment-" + docId + "'></textarea><button id='save-" + docId + "'>Save</button><button id='delete-" + docId + "'>Delete</button><button id='cancel-" + docId + "'>Cancel</button><p>Comments</p><textarea id='display-comment-" + docId + "' readonly>" + (data.comment || '') + "</textarea>");
        } else if (change.type === "removed") {
            let marker = markersMapping[docId];
            marker.setMap(null);
            delete markersMapping[docId];
        }
    });
});

    // This section of code allows users to add new markers by clicking on the map
    map.addListener("click", (e) => {
        var user = firebase.auth().currentUser;

        if (user) {
            // User is signed in, so you can add a marker
            db.collection("markers").add({
                lat: e.latLng.lat(),
                lng: e.latLng.lng(),
                comment: ''
            })
            .then((docRef) => {
                console.log("Document written with ID: ", docRef.id);
                createMarker(e.latLng.lat(), e.latLng.lng(), docRef.id, map, db, true);
            })
            .catch((error) => {
                console.error("Error adding document: ", error);
            });
        } else {
            // No user is signed in, so don't add a marker
            alert("You must be logged in to add a marker!");
        }
    });
}

    
    <!-- Google Maps JavaScript API -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDcfiNc46fa84JCUigitTvwvlUF_XNIGKs&callback=initMap"></script>

</body>
</html>

                               

